<% layout("/layouts/boilerPlate.ejs") %>
<body class="bg-light">

<div class="card shadow-lg rounded-4 border-0 mb-5 mt-4 overflow-hidden mx-auto" style="max-width: 32rem;">
  <img src="<%= listing.image.url %>" 
       alt="<%= listing.title %>" 
       class="card-img-top"
       style="width: 100%; height: 220px; object-fit: cover;">

  <div class="card-body p-4">
    <h6 class="text-muted mb-2">Hosted by <span class="fw-semibold"><%= listing.owner.username %></span></h6>
    <h3 class="fw-bold mb-3"><%= listing.title %></h3>
    <p class="text-secondary mb-3"><%= listing.description %></p>
    <div class="d-flex justify-content-between align-items-center mb-3">
      <span class="fs-5 fw-bold text-primary">&#8377;<%= listing.price.toLocaleString("en-IN") %> / night</span>
    </div>
    <div class="mb-2"><i class="fa-solid fa-location-dot text-danger me-2"></i><%= listing.location %></div>
    <div><i class="fa-solid fa-globe text-success me-2"></i><%= listing.country %></div>

    <% if(currUser && currUser._id.equals(listing.owner._id)){ %>
    <div class="d-flex gap-2 mt-4">
      <a href="/listings/<%= listing._id %>/edit" class="btn btn-warning btn-sm flex-fill rounded-3">Edit</a>
      <form action="/listings/<%= listing._id %>?_method=delete" method="post" class="flex-fill">
        <button class="btn btn-danger btn-sm w-100 rounded-3">Delete</button>
      </form>
    </div>
    <% } %>
  </div>
</div>

<% if(currUser){ %>
<div class="container mb-5" style="max-width: 55rem;">
  <div class="row justify-content-center">
    <div class="col-md-7">
      <div class="card shadow-sm rounded-4 border-0 p-4">
        <h4 class="fw-bold text-center mb-4">Write a Review</h4>
        <form novalidate class="needs-validation" method="post" action="/listings/<%=listing._id%>/review">
          <div class="mb-4">
            <label class="form-label fw-semibold">Rating</label>
            <fieldset class="starability-slot">
              <input type="radio" id="no-rate" class="input-no-rate" name="rating" value="0" checked />
              <input type="radio" id="rate1" name="rating" value="1" /><label for="rate1">1 star</label>
              <input type="radio" id="rate2" name="rating" value="2" /><label for="rate2">2 stars</label>
              <input type="radio" id="rate3" name="rating" value="3" /><label for="rate3">3 stars</label>
              <input type="radio" id="rate4" name="rating" value="4" /><label for="rate4">4 stars</label>
              <input type="radio" id="rate5" name="rating" value="5" /><label for="rate5">5 stars</label>
            </fieldset>
          </div>
          <div class="mb-4">
            <label class="form-label fw-semibold">Comment</label>
            <textarea class="form-control rounded-3" name="comment" rows="4" placeholder="Share your experience..." required></textarea>
            <div class="invalid-feedback">Please add a comment</div>
          </div>
          <button type="submit" class="btn btn-primary w-100 rounded-3 py-2 fw-semibold">Submit Review</button>
        </form>
      </div>
    </div>
  </div>
</div>
<% } %>

<div class="container mb-5" style="max-width: 70rem;">
  <h4 class="fw-bold mb-4">What People Say</h4>
  <div class="row g-4">
    <% for (let review of listing.reviews) { %>
      <div class="col-md-6">
        <div class="card shadow-sm rounded-4 border-0 h-100">
          <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h6 class="fw-semibold mb-0"><%= review.author.username %></h6>
              <p class="starability-result mb-0" data-rating="<%= review.rating %>"></p>
            </div>
            <p class="text-secondary mb-3"><%= review.comment %></p>
            <% if(currUser && review.author._id.equals(currUser._id)) { %>
              <form action="/listings/<%=listing._id%>/review/<%=review._id%>?_method=delete" method="post">
                <button class="btn btn-outline-danger btn-sm rounded-3">Delete</button>
              </form>
            <% } %>
          </div>
        </div>
      </div>
    <% } %>
  </div>
</div>

</body>


